<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<style>
		.monospace {
			font-family: monospace;
		}

		h2 {
			border-bottom: 1px solid rgba(255, 255, 255, 0.226)
		}

		label {
			font-weight: bold;
		}
	</style>
</head>
<body>
	<div>
		<div>
			<span>Status: </span><span id="connection-status"></span>
		</div>
		<div>
			<button id="btn-connect"></button>
		</div>
		<br />
		<div id="timer-info">
			<h2>Timer Info</h2>
			<label>Current Timer Phase: </label><span id="currentTimerPhase"></span><br />
			<label>Total Delta: </label><span id="delta"></span><br />
			<label>Last Split Time: </label><span id="lastSplitTime"></span><br />
			<label>Comparison Split Time: </label><span id="comparisonSplitTime"></span><br />
			<label>Current Time: </label><span id="currentTime"></span><br />
			<label>Final Time: </label><span id="finalTime"></span><br />
			<label>PredictedTime: </label><span id="predictedTime"></span><br />
			<label>BestPossibleTime: </label><span id="bestPossibleTime"></span><br />
			<label>Split Index: </label><span id="splitIndex"></span><br />
			<label>Current Split Name: </label><span id="currentSplitName"></span><br />
			<label>Previous Split Name: </label><span id="previousSplitname"></span><br />
		</div>
	</div>
	<script>
		const rLivesplit = nodecg.Replicant('livesplit')
		const button = document.getElementById('btn-connect')

		rLivesplit.on('change', (newValue, oldValue) => {
			const connStatus = newValue.connection.status
			if (connStatus === 'connected') {
				button.innerText = 'Disconnect'
			} else {
				button.innerText = 'Connect'
			}
			document.getElementById('connection-status').textContent = `${connStatus.charAt(0).toUpperCase()}${connStatus.slice(1)} ${connStatus === 'connected' ? 'to' : 'from'} LiveSplit`

			if (newValue.timer) {
				Object.keys(newValue.timer).forEach( key => {
					document.getElementById(key).textContent = newValue.timer[key]
				})
				document.getElementById('timer-info').style.display = 'block'
			} else {
				document.getElementById('timer-info').style.display = 'none'
			}
		})

		button.onclick = (ev) => {
			if (button.innerText === 'Connect') {
				nodecg.sendMessage('connect')
					.then(result => {
						console.log('connection successful')
					}).catch(error => {
						console.error(error)
					})
			} else {
				nodecg.sendMessage('disconnect')
			}
		}
	</script>
</body>
</html>
