<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<link rel="stylesheet" href="https://use.typekit.net/eur4mqo.css">
	<style>
		/* css reset */
		* {
			padding: 0;
			margin: 0;
		}

		body {
			font-family: sans-serif;
			background:rgba(37, 68, 56, 0.705);
		}

		.monospace {
			font-family: monospace;
		}

		h2 {
			border-bottom: 1px solid rgba(0, 0, 0, 0.205);
		}

		label {
			font-weight: bold;
		}

		/* widget */
		.widget-container {
			margin: 50px 0 0 50px;
			display: inline-block;
		}

		.widget-upper-border {
			position: relative;
			width: 420px;
			height: 60px;
			overflow: visible;
			filter: drop-shadow(0 0 4px rgba(0, 0, 0, 0.75));
		}
		.widget-upper-border::after {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			z-index: -2;
			width: 100%;
			height: 100%;
			background-color: #f9f9f9;
			/* I used math! These percentages are based on the following:
			   1. A width-to-height ratio of 7 to 1
			   2. A slant angle of 15째 (or 85째)
			   If the width-to-height ratio changes, these will need to as well.
			   The calculation is tan(t)*h/w to get the percentage of width for point 4. */
			clip-path: polygon(0 0, 100% 0, 96.17% 100%, 3.83% 100%);
		}

		.widget-upper {
			position: absolute;
			display: flex;
			justify-content: space-between;
			align-items: center;
			gap: 75px;
			top: 1pt;
			left: 1pt;
			width: calc(420px - 2pt);
			height: calc(60px - 2pt);
			color: #f9f9f9;

			/* This makes it easier to think about padding wrt the full size */
			box-sizing: border-box;
		}
		.widget-upper::after {
			content: '';
			display: block;
			position: absolute;
			top: 0;
			left: 0;
			z-index: -1;
			width: 100%;
			height: 100%;
			background-image: linear-gradient(to right, #1976d2, #1a1a1a, #1976d2);
			clip-path: polygon(0.1% 0, 99.9% 0, 96.17% 100%, 3.83% 100%);
		}

		.widget-inner-left,
		.widget-inner-right {
			width: 50%;
			max-width: calc((418px - 75px) / 2 - (0.08 * (418px / 2))); /* half of container width (after gap) - margins */
			max-height: 100%;
			flex-grow: 0;
			display: flex;
			white-space: nowrap;
		}
		.widget-inner-left {
			margin-left: 4%;
			clip-path: polygon(-8.27% 0, 100% 0, 100% 100%, -1% 100%);
			justify-content: flex-end; /* align contents to right when greater than max-width */
		}
		.widget-inner-right {
			margin-right: 4%;
			clip-path: polygon(0 0, 108.27% 0, 101% 100%, 0 100%);
			justify-content: flex-start; /* unnecessary, but being explicit to match -left */
		}

		.widget-inner-left > div,
		.widget-inner-right > div {
			margin: auto;
		}

		.widget-inner-circle {
			position: absolute;
			left: 50%;
			transform: translate(-50%, 0);
			width: 70px;
			height: 70px;
			background-color: #15315d;
			background-position: center;
			background-size: contain;
			background-repeat: no-repeat;
			border-radius: 50%;
			border: 2pt solid #1a1a1a;
			overflow: hidden;
			box-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.75);
		}

		/* widget lower */
		.widget-lower-border {
			position: relative;
			width: 360px;
			height: calc(30px + 2pt);
			z-index: -1;
			filter: drop-shadow(0 0 4px rgba(0, 0, 0, 0.75));
			margin: -1pt auto 0;
		}
		.widget-lower-border::after {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			z-index: -2;
			width: 100%;
			height: 100%;
			background-color: #f9f9f9;
			/* I used math! These percentages are based on the following:
			   1. A width-to-height ratio of 12 to 1
			   2. A slant angle of 15째 (or 85째)
			   If the width-to-height ratio changes, these will need to as well.
			   The calculation is tan(t)*h/w to get the percentage of width for point 4. */
			clip-path: polygon(0 0, 100% 0, 97.77% 100%, 2.23% 100%);
		}

		.widget-lower {
			position: absolute;
			top: 1pt;
			left: 1pt;
			width: calc(360px - 2pt);
			height: 30px;
			color: #f9f9f9;
			text-align: center;
			white-space: nowrap;
			background-color: #1a1a1a;
			clip-path: polygon(0.1% 0, 99.9% 0, 97.77% 100%, 2.23% 100%);
		}

		/* timers */
		.timer {
			font-family: vox-round, sans-serif;
			font-weight: 600;
			font-style: normal;
			font-size: xx-large;
		}

		.timer-sub {
			font-size: 60%;
		}

		.timer-ahead {
			color: #99ff99;
		}

		.timer-behind {
			color: #ff9999;
		}

		/* text info */
		.text {
			font-family: apotek-cond, sans-serif;
			font-weight: 300;
			font-style: normal;
			font-size: 24pt;
			line-height: 1em;
			display: flex;
			justify-content: center;
		}
	</style>
</head>
<body>
	<div class="widget-container">
		<div class="widget-upper-border">
			<div class="widget-upper">
				<div class="widget-inner-left">
					<div id="widget-timer-current" class="timer">
						<span class="timer-main">5:09:18</span><span class="timer-sub">.45</span>
					</div>
				</div>
				<div class="widget-inner-circle"></div>
				<div class="widget-inner-right">
					<div id="widget-timer-delta" class="timer">
						<span class="timer-main">-4:17</span><span class="timer-sub">.36</span>
					</div>
				</div>
			</div>
		</div>
		<div class="widget-lower-border">
			<div class="widget-lower">
				<div id="widget-info-splitName" class="text">
					<span>KH2FM - Any% Critical Mode</span>
				</div>
			</div>
		</div>
	</div>
	<br />
	<br />
	<br />
	<p id="connection-status"></p>

	<script>
		const rLivesplit = nodecg.Replicant('livesplit')
		const rLogos = nodecg.Replicant('assets:logos')

		rLivesplit.on('change', (newValue, oldValue) => {
			const connStatus = newValue.connection.status
			document.getElementById('connection-status').textContent = `${connStatus.charAt(0).toUpperCase()}${connStatus.slice(1)} ${connStatus === 'connected' ? 'to' : 'from'} LiveSplit`

			if (newValue.timer) {
				// We're not really going to put the main timer on the widget via code - that'll be handled in OBS.
				// But I'll leave these lines commented for now because we may put something else there.
				// document.querySelector('#widget-timer-current .timer-main').innerText = newValue.timer.currentTime.slice(0, -2)
				// document.querySelector('#widget-timer-current .timer-sub').innerText = newValue.timer.currentTime.slice(-2)

				document.querySelector('#widget-timer-delta .timer-main').innerText = newValue.timer.delta.slice(0, -2)
				document.querySelector('#widget-timer-delta .timer-sub').innerText = newValue.timer.delta.slice(-2)

				if (newValue.timer.delta.charAt(0) === '+') {
					document.getElementById('widget-timer-delta').classList.add('timer-behind')
					document.getElementById('widget-timer-delta').classList.remove('timer-ahead')
				} else {
					document.getElementById('widget-timer-delta').classList.add('timer-ahead')
					document.getElementById('widget-timer-delta').classList.remove('timer-behind')
				}
			}
		})

		rLogos.on('change', (newValue, oldValue) => {
			console.log(newValue[0])
			document.querySelector('.widget-inner-circle').style.backgroundImage = `url('${newValue[0].url}')`
		})
	</script>
</body>
</html>
